{"version":3,"file":"database-f81a56a9.js","sources":["../../../.svelte-kit/adapter-node/chunks/database.js"],"sourcesContent":["import { M as MONGODB_URL, b as MONGODB_DIRECT_CONNECTION, c as MONGODB_DB_NAME } from \"./private.js\";\nimport { MongoClient, GridFSBucket } from \"mongodb\";\nconst client = new MongoClient(MONGODB_URL, {\n  directConnection: MONGODB_DIRECT_CONNECTION === \"true\"\n});\nclient.connect().catch(console.error);\nconst db = client.db(MONGODB_DB_NAME + \"\");\nconst CONVERSATION_STATS_COLLECTION = \"conversations.stats\";\nconst conversations = db.collection(\"conversations\");\nconst conversationStats = db.collection(CONVERSATION_STATS_COLLECTION);\nconst assistants = db.collection(\"assistants\");\nconst reports = db.collection(\"reports\");\nconst sharedConversations = db.collection(\"sharedConversations\");\nconst abortedGenerations = db.collection(\"abortedGenerations\");\nconst settings = db.collection(\"settings\");\nconst users = db.collection(\"users\");\nconst sessions = db.collection(\"sessions\");\nconst messageEvents = db.collection(\"messageEvents\");\nconst bucket = new GridFSBucket(db, { bucketName: \"files\" });\nconst collections = {\n  conversations,\n  conversationStats,\n  assistants,\n  reports,\n  sharedConversations,\n  abortedGenerations,\n  settings,\n  users,\n  sessions,\n  messageEvents,\n  bucket\n};\nclient.on(\"open\", () => {\n  conversations.createIndex(\n    { sessionId: 1, updatedAt: -1 },\n    { partialFilterExpression: { sessionId: { $exists: true } } }\n  ).catch(console.error);\n  conversations.createIndex(\n    { userId: 1, updatedAt: -1 },\n    { partialFilterExpression: { userId: { $exists: true } } }\n  ).catch(console.error);\n  conversations.createIndex(\n    { \"message.id\": 1, \"message.ancestors\": 1 },\n    { partialFilterExpression: { userId: { $exists: true } } }\n  ).catch(console.error);\n  conversations.createIndex({ updatedAt: 1 }).catch(console.error);\n  conversations.createIndex({ createdAt: 1 }).catch(console.error);\n  conversations.createIndex({ \"messages.createdAt\": 1 }, { sparse: true }).catch(console.error);\n  conversationStats.createIndex(\n    {\n      type: 1,\n      \"date.field\": 1,\n      \"date.span\": 1,\n      \"date.at\": 1,\n      distinct: 1\n    },\n    { unique: true }\n  ).catch(console.error);\n  conversationStats.createIndex({\n    type: 1,\n    \"date.field\": 1,\n    \"date.at\": 1\n  }).catch(console.error);\n  abortedGenerations.createIndex({ updatedAt: 1 }, { expireAfterSeconds: 30 }).catch(console.error);\n  abortedGenerations.createIndex({ conversationId: 1 }, { unique: true }).catch(console.error);\n  sharedConversations.createIndex({ hash: 1 }, { unique: true }).catch(console.error);\n  settings.createIndex({ sessionId: 1 }, { unique: true, sparse: true }).catch(console.error);\n  settings.createIndex({ userId: 1 }, { unique: true, sparse: true }).catch(console.error);\n  settings.createIndex({ assistants: 1 }).catch(console.error);\n  users.createIndex({ hfUserId: 1 }, { unique: true }).catch(console.error);\n  users.createIndex({ sessionId: 1 }, { unique: true, sparse: true }).catch(console.error);\n  users.createIndex({ username: 1 }).catch(console.error);\n  messageEvents.createIndex({ createdAt: 1 }, { expireAfterSeconds: 60 }).catch(console.error);\n  sessions.createIndex({ expiresAt: 1 }, { expireAfterSeconds: 0 }).catch(console.error);\n  sessions.createIndex({ sessionId: 1 }, { unique: true }).catch(console.error);\n  assistants.createIndex({ createdById: 1, userCount: -1 }).catch(console.error);\n  assistants.createIndex({ userCount: 1 }).catch(console.error);\n  assistants.createIndex({ featured: 1, userCount: -1 }).catch(console.error);\n  assistants.createIndex({ modelId: 1, userCount: -1 }).catch(console.error);\n  reports.createIndex({ assistantId: 1 }).catch(console.error);\n  reports.createIndex({ createdBy: 1, assistantId: 1 }).catch(console.error);\n});\nexport {\n  CONVERSATION_STATS_COLLECTION as C,\n  collections as c\n};\n"],"names":[],"mappings":"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"}