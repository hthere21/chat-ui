import{s as C,m as P,a as y,o as I,f as h,g as A,i as $,p as k,l as O}from"../chunks/scheduler.6a9d17f6.js";import{S as R,i as j,b as N,c as T,a as q,m as B,t as G,d as J,e as L}from"../chunks/index.f8ec6462.js";import{g as U}from"../chunks/navigation.bcbcd3d3.js";import{b as w}from"../chunks/singletons.dcb5d507.js";import{P as W}from"../chunks/public.bedf1950.js";import{f as M,C as z,p as D}from"../chunks/pendingMessage.54687045.js";import{e as b,E as F}from"../chunks/cookiesAreEnabled.35a078a4.js";import{u as H}from"../chunks/settings.053bb39b.js";function K(t){let r,s,n,o;document.title=W;function c(e){t[6](e)}let d={loading:t[1],assistant:t[0].assistant,currentModel:M([...t[0].models,...t[0].oldModels],t[3].activeModel),models:t[0].models};return t[2]!==void 0&&(d.files=t[2]),s=new z({props:d}),P.push(()=>N(s,"files",c)),s.$on("message",t[7]),{c(){r=y(),T(s.$$.fragment)},l(e){I("svelte-1o4lg8n",document.head).forEach(h),r=A(e),q(s.$$.fragment,e)},m(e,a){$(e,r,a),B(s,e,a),o=!0},p(e,[a]){const l={};a&2&&(l.loading=e[1]),a&1&&(l.assistant=e[0].assistant),a&9&&(l.currentModel=M([...e[0].models,...e[0].oldModels],e[3].activeModel)),a&1&&(l.models=e[0].models),!n&&a&4&&(n=!0,l.files=e[2],k(()=>n=!1)),s.$set(l)},i(e){o||(G(s.$$.fragment,e),o=!0)},o(e){J(s.$$.fragment,e),o=!1},d(e){e&&h(r),L(s,e)}}}function Q(t,r,s){let n,{data:o}=r,c=!1,d=[];const e=H();O(t,e,i=>s(3,n=i));async function a(i){var u,_,g;try{s(1,c=!0);const m=o.models.map(E=>E.id);let f;m.includes(n.activeModel)?f=n.activeModel:m.includes((u=o.assistant)==null?void 0:u.modelId)?f=(_=o.assistant)==null?void 0:_.modelId:f=o.models[0].id;const p=await fetch(`${w}/conversation`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:f,preprompt:n.customPrompts[n.activeModel],assistantId:(g=o.assistant)==null?void 0:g._id})});if(!p.ok){b.set("Error while creating conversation, try again."),console.error("Error while creating conversation: "+await p.text());return}const{conversationId:S}=await p.json();D.set({content:i,files:d}),await U(`${w}/conversation/${S}`,{invalidateAll:!0})}catch(m){b.set(F.default),console.error(m)}finally{s(1,c=!1)}}function l(i){d=i,s(2,d)}const v=i=>a(i.detail);return t.$$set=i=>{"data"in i&&s(0,o=i.data)},[o,c,d,n,e,a,l,v]}class oe extends R{constructor(r){super(),j(this,r,Q,K,C,{data:0})}}export{oe as component};
